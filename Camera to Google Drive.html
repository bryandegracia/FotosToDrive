<!DOCTYPE html>
<html lang="es">
<head>
ย ย <meta charset="UTF-8">
ย ย <meta name="viewport" content="width=device-width, initial-scale=1.0">
ย ย <title>Cรกmara a Google Drive</title>
ย ย <style>
ย ย ย ย * {
ย ย ย ย ย ย margin: 0;
ย ย ย ย ย ย padding: 0;
ย ย ย ย ย ย box-sizing: border-box;
ย ย ย ย }

ย ย ย ย body {
ย ย ย ย ย ย font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
ย ย ย ย ย ย background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
ย ย ย ย ย ย min-height: 100vh;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย justify-content: center;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย padding: 20px;
ย ย ย ย }

ย ย ย ย .container {
ย ย ย ย ย ย background: white;
ย ย ย ย ย ย border-radius: 20px;
ย ย ย ย ย ย box-shadow: 0 20px 60px rgba(0,0,0,0.3);
ย ย ย ย ย ย max-width: 500px;
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย padding: 30px;
ย ย ย ย }

ย ย ย ย h1 {
ย ย ย ย ย ย color: #333;
ย ย ย ย ย ย text-align: center;
ย ย ย ย ย ย margin-bottom: 30px;
ย ย ย ย ย ย font-size: 24px;
ย ย ย ย }

ย ย ย ย .auth-section {
ย ย ย ย ย ย text-align: center;
ย ย ย ย ย ย margin-bottom: 20px;
ย ย ย ย }

ย ย ย ย .status {
ย ย ย ย ย ย padding: 15px;
ย ย ย ย ย ย border-radius: 10px;
ย ย ย ย ย ย margin-bottom: 20px;
ย ย ย ย ย ย font-size: 14px;
ย ย ย ย }

ย ย ย ย .status.info {
ย ย ย ย ย ย background: #e3f2fd;
ย ย ย ย ย ย color: #1976d2;
ย ย ย ย ย ย border: 1px solid #90caf9;
ย ย ย ย }

ย ย ย ย .status.success {
ย ย ย ย ย ย background: #e8f5e9;
ย ย ย ย ย ย color: #388e3c;
ย ย ย ย ย ย border: 1px solid #81c784;
ย ย ย ย }

ย ย ย ย .status.error {
ย ย ย ย ย ย background: #ffebee;
ย ย ย ย ย ย color: #c62828;
ย ย ย ย ย ย border: 1px solid #ef5350;
ย ย ย ย }

ย ย ย ย button {
ย ย ย ย ย ย background: #4285f4;
ย ย ย ย ย ย color: white;
ย ย ย ย ย ย border: none;
ย ย ย ย ย ย padding: 12px 24px;
ย ย ย ย ย ย border-radius: 8px;
ย ย ย ย ย ย font-size: 16px;
ย ย ย ย ย ย cursor: pointer;
ย ย ย ย ย ย transition: all 0.3s;
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย margin-bottom: 10px;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย justify-content: center;
ย ย ย ย ย ย gap: 10px;
ย ย ย ย }

ย ย ย ย button:hover {
ย ย ย ย ย ย background: #357ae8;
ย ย ย ย ย ย transform: translateY(-2px);
ย ย ย ย ย ย box-shadow: 0 5px 15px rgba(66, 133, 244, 0.3);
ย ย ย ย }

ย ย ย ย button:disabled {
ย ย ย ย ย ย background: #ccc;
ย ย ย ย ย ย cursor: not-allowed;
ย ย ย ย ย ย transform: none;
ย ย ย ย }

ย ย ย ย button.logout {
ย ย ย ย ย ย background: #dc3545;
ย ย ย ย }

ย ย ย ย button.logout:hover {
ย ย ย ย ย ย background: #c82333;
ย ย ย ย }

ย ย ย ย button.capture {
ย ย ย ย ย ย background: #34a853;
ย ย ย ย }

ย ย ย ย button.capture:hover {
ย ย ย ย ย ย background: #2d8e47;
ย ย ย ย }

ย ย ย ย .camera-section {
ย ย ย ย ย ย display: none;
ย ย ย ย }

ย ย ย ย .camera-section.active {
ย ย ย ย ย ย display: block;
ย ย ย ย }

ย ย ย ย video, canvas {
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย border-radius: 10px;
ย ย ย ย ย ย margin-bottom: 15px;
ย ย ย ย ย ย background: #000;
ย ย ย ย }

ย ย ย ย canvas {
ย ย ย ย ย ย display: none;
ย ย ย ย }

ย ย ย ย .preview {
ย ย ย ย ย ย margin-top: 20px;
ย ย ย ย }

ย ย ย ย .preview img {
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย border-radius: 10px;
ย ย ย ย ย ย margin-bottom: 15px;
ย ย ย ย }

ย ย ย ย .user-info {
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย gap: 10px;
ย ย ย ย ย ย padding: 15px;
ย ย ย ย ย ย background: #f5f5f5;
ย ย ย ย ย ย border-radius: 10px;
ย ย ย ย ย ย margin-bottom: 20px;
ย ย ย ย }

ย ย ย ย .user-info img {
ย ย ย ย ย ย width: 40px;
ย ย ย ย ย ย height: 40px;
ย ย ย ย ย ย border-radius: 50%;
ย ย ย ย }

ย ย ย ย .user-info .name {
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย ย ย color: #333;
ย ย ย ย }

ย ย ย ย .user-info .email {
ย ย ย ย ย ย font-size: 12px;
ย ย ย ย ย ย color: #666;
ย ย ย ย }

ย ย ย ย .google-icon {
ย ย ย ย ย ย width: 20px;
ย ย ย ย ย ย height: 20px;
ย ย ย ย }
ย ย </style>
</head>

<body>
ย ย <div class="container">
ย ย ย ย <h1>๐ธ Cรกmara a Google Drive</h1>

ย ย ย ย <div id="authSection" class="auth-section">
ย ย ย ย ย ย <div class="status info">
ย ย ย ย ย ย ย ย Por favor, inicia sesiรณn con tu cuenta de Google para continuar
ย ย ย ย ย ย </div>
ย ย ย ย ย ย <button id="loginBtn" onclick="handleLogin()">
ย ย ย ย ย ย ย ย <svg class="google-icon" viewBox="0 0 24 24">
ย ย ย ย ย ย ย ย ย ย <path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
ย ย ย ย ย ย ย ย ย ย <path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
ย ย ย ย ย ย ย ย ย ย <path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
ย ย ย ย ย ย ย ย ย ย <path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
ย ย ย ย ย ย ย ย </svg>
ย ย ย ย ย ย ย ย Iniciar sesiรณn con Google
ย ย ย ย ย ย </button>
ย ย ย ย </div>

ย ย ย ย <div id="userSection" style="display: none;">
ย ย ย ย ย ย <div id="userInfo" class="user-info"></div>
ย ย ย ย ย ย <button class="logout" onclick="handleLogout()">Cerrar sesiรณn</button>
ย ย ย ย </div>

ย ย ย ย <div id="cameraSection" class="camera-section">
ย ย ย ย ย ย <video id="video" autoplay playsinline></video>
ย ย ย ย ย ย <canvas id="canvas"></canvas>

ย ย ย ย ย ย <button class="capture" onclick="capturePhoto()">๐ท Tomar Foto</button>
ย ย ย ย ย ย <button onclick="stopCamera()">โ Cerrar Cรกmara</button>

ย ย ย ย ย ย <div id="preview" class="preview"></div>
ย ย ย ย </div>

ย ย ย ย <div id="status"></div>
ย ย </div>

ย ย <script>
ย ย ย ย // ==============================================
ย ย ย ย // ๐ CREDENCIALES ACTUALIZADAS PARA GITHUB PAGES
ย ย ย ย // ==============================================
ย ย ย ย // ID del Cliente Web 2 (el que tiene la URL de GitHub Pages autorizada)
ย ย ย ย const CLIENT_ID = '364672144294-lle6m16lka75jrvjqhphd836mo2nvv6i.apps.googleusercontent.com'; // <--- ยกID DE GITHUB PAGES APLICADO!
ย ย ย ย // Tu API Key (Deberรญas restringir esta clave en Google Cloud)
ย ย ย ย const API_KEY = 'AIzaSyASXynCWpfFJkUl0KCP9o--7xTE_FD86Hk';

ย ย ย ย const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest';
ย ย ย ย const SCOPES = 'https://www.googleapis.com/auth/drive.file';

ย ย ย ย let tokenClient;
ย ย ย ย let gapiInited = false;
ย ย ย ย let gisInited = false;
ย ย ย ย let stream = null;

ย ย ย ย // Cargar las librerรญas de Google
ย ย ย ย function loadGoogleAPIs() {
ย ย ย ย ย ย const gapiScript = document.createElement('script');
ย ย ย ย ย ย gapiScript.src = 'https://apis.google.com/js/api.js';
ย ย ย ย ย ย gapiScript.onload = gapiLoaded;
ย ย ย ย ย ย document.body.appendChild(gapiScript);

ย ย ย ย ย ย const gisScript = document.createElement('script');
ย ย ย ย ย ย gisScript.src = 'https://accounts.google.com/gsi/client';
ย ย ย ย ย ย gisScript.onload = gisLoaded;
ย ย ย ย ย ย document.body.appendChild(gisScript);
ย ย ย ย }

ย ย ย ย function gapiLoaded() {
ย ย ย ย ย ย gapi.load('client', initializeGapiClient);
ย ย ย ย }

ย ย ย ย async function initializeGapiClient() {
ย ย ย ย ย ย await gapi.client.init({
ย ย ย ย ย ย ย ย apiKey: API_KEY,
ย ย ย ย ย ย ย ย discoveryDocs: [DISCOVERY_DOC],
ย ย ย ย ย ย });
ย ย ย ย ย ย gapiInited = true;
ย ย ย ย }

ย ย ย ย function gisLoaded() {
ย ย ย ย ย ย tokenClient = google.accounts.oauth2.initTokenClient({
ย ย ย ย ย ย ย ย client_id: CLIENT_ID,
ย ย ย ย ย ย ย ย scope: SCOPES,
ย ย ย ย ย ย ย ย callback: '', // Se define mรกs adelante
ย ย ย ย ย ย });
ย ย ย ย ย ย gisInited = true;
ย ย ย ย }

ย ย ย ย function handleLogin() {
ย ย ย ย ย ย tokenClient.callback = async (resp) => {
ย ย ย ย ย ย ย ย if (resp.error !== undefined) {
ย ย ย ย ย ย ย ย ย ย showStatus('Error al iniciar sesiรณn: ' + resp.error, 'error');
ย ย ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย await loadUserInfo();
ย ย ย ย ย ย ย ย document.getElementById('authSection').style.display = 'none';
ย ย ย ย ย ย ย ย document.getElementById('userSection').style.display = 'block';
ย ย ย ย ย ย ย ย document.getElementById('cameraSection').classList.add('active');
ย ย ย ย ย ย ย ย showStatus('ยกSesiรณn iniciada correctamente!', 'success');
ย ย ย ย ย ย ย ย startCamera();
ย ย ย ย ย ย };

ย ย ย ย ย ย if (gapi.client.getToken() === null) {
ย ย ย ย ย ย ย ย tokenClient.requestAccessToken({prompt: 'consent'});
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย tokenClient.requestAccessToken({prompt: ''});
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย async function loadUserInfo() {
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย const response = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', {
ย ย ย ย ย ย ย ย ย ย headers: {
ย ย ย ย ย ย ย ย ย ย ย ย Authorization: `Bearer ${gapi.client.getToken().access_token}`
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย const userInfo = await response.json();

ย ย ย ย ย ย ย ย document.getElementById('userInfo').innerHTML = `
ย ย ย ย ย ย ย ย ย ย <img src="${userInfo.picture}" alt="Avatar">
ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="name">${userInfo.name}</div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="email">${userInfo.email}</div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย `;
ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย console.error('Error al cargar informaciรณn del usuario:', error);
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย function handleLogout() {
ย ย ย ย ย ย const token = gapi.client.getToken();
ย ย ย ย ย ย if (token !== null) {
ย ย ย ย ย ย ย ย google.accounts.oauth2.revoke(token.access_token);
ย ย ย ย ย ย ย ย gapi.client.setToken('');
ย ย ย ย ย ย }

ย ย ย ย ย ย stopCamera();
ย ย ย ย ย ย document.getElementById('authSection').style.display = 'block';
ย ย ย ย ย ย document.getElementById('userSection').style.display = 'none';
ย ย ย ย ย ย document.getElementById('cameraSection').classList.remove('active');
ย ย ย ย ย ย document.getElementById('preview').innerHTML = '';
ย ย ย ย ย ย showStatus('Sesiรณn cerrada', 'info');
ย ย ย ย }

ย ย ย ย async function startCamera() {
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย stream = await navigator.mediaDevices.getUserMedia({ย
ย ย ย ย ย ย ย ย ย ย video: { facingMode: 'environment' },
ย ย ย ย ย ย ย ย ย ย audio: falseย
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย document.getElementById('video').srcObject = stream;
ย ย ย ย ย ย ย ย showStatus('Cรกmara activada', 'success');
ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย showStatus('Error al acceder a la cรกmara: ' + error.message, 'error');
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย function stopCamera() {
ย ย ย ย ย ย if (stream) {
ย ย ย ย ย ย ย ย stream.getTracks().forEach(track => track.stop());
ย ย ย ย ย ย ย ย document.getElementById('video').srcObject = null;
ย ย ย ย ย ย ย ย stream = null;
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย function capturePhoto() {
ย ย ย ย ย ย const video = document.getElementById('video');
ย ย ย ย ย ย const canvas = document.getElementById('canvas');
ย ย ย ย ย ย const context = canvas.getContext('2d');

ย ย ย ย ย ย canvas.width = video.videoWidth;
ย ย ย ย ย ย canvas.height = video.videoHeight;
ย ย ย ย ย ย context.drawImage(video, 0, 0);

ย ย ย ย ย ย canvas.toBlob(async (blob) => {
ย ย ย ย ย ย ย ย const preview = document.getElementById('preview');
ย ย ย ย ย ย ย ย const img = document.createElement('img');
ย ย ย ย ย ย ย ย img.src = URL.createObjectURL(blob);

ย ย ย ย ย ย ย ย const uploadBtn = document.createElement('button');
ย ย ย ย ย ย ย ย uploadBtn.textContent = 'โ๏ธ Subir a Google Drive';
ย ย ย ย ย ย ย ย uploadBtn.onclick = () => uploadToDrive(blob);

ย ย ย ย ย ย ย ย preview.innerHTML = '';
ย ย ย ย ย ย ย ย preview.appendChild(img);
ย ย ย ย ย ย ย ย preview.appendChild(uploadBtn);
ย ย ย ย ย ย }, 'image/jpeg', 0.95);
ย ย ย ย }

ย ย ย ย async function uploadToDrive(blob) {
ย ย ย ย ย ย showStatus('Subiendo foto a Google Drive...', 'info');

ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย const metadata = {
ย ย ย ย ย ย ย ย ย ย name: `foto_${new Date().getTime()}.jpg`,
ย ย ย ย ย ย ย ย ย ย mimeType: 'image/jpeg'
ย ย ย ย ย ย ย ย };

ย ย ย ย ย ย ย ย const form = new FormData();
ย ย ย ย ย ย ย ย form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
ย ย ย ย ย ย ย ย form.append('file', blob);

ย ย ย ย ย ย ย ย const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
ย ย ย ย ย ย ย ย ย ย method: 'POST',
ย ย ย ย ย ย ย ย ย ย headers: {
ย ย ย ย ย ย ย ย ย ย ย ย Authorization: `Bearer ${gapi.client.getToken().access_token}`
ย ย ย ย ย ย ย ย ย ย },
ย ย ย ย ย ย ย ย ย ย body: form
ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย ย ย if (response.ok) {
ย ย ย ย ย ย ย ย ย ย const result = await response.json();
ย ย ย ย ย ย ย ย ย ย showStatus('โ Foto subida exitosamente a Google Drive!', 'success');
ย ย ย ย ย ย ย ย ย ย document.getElementById('preview').innerHTML = '';
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย const errorText = await response.text();
ย ย ย ย ย ย ย ย ย ย throw new Error(errorText || 'Error al subir archivo');
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย showStatus('โ Error al subir la foto: ' + error.message, 'error');
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย function showStatus(message, type) {
ย ย ย ย ย ย const statusDiv = document.getElementById('status');
ย ย ย ย ย ย statusDiv.className = 'status ' + type;
ย ย ย ย ย ย statusDiv.textContent = message;
ย ย ย ย ย ย statusDiv.style.display = 'block';

ย ย ย ย ย ย if (type === 'success') {
ย ย ย ย ย ย ย ย setTimeout(() => {
ย ย ย ย ย ย ย ย ย ย statusDiv.style.display = 'none';
ย ย ย ย ย ย ย ย }, 5000);
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย // Inicializar al cargar la pรกgina
ย ย ย ย window.onload = loadGoogleAPIs;
ย ย </script>
</body>
</html>